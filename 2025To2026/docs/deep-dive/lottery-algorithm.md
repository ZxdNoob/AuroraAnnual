# 抽奖算法原理

## 概述

抽奖算法使用加权随机算法，根据奖品权重计算抽中概率。

## 算法原理

### 加权随机算法

1. 计算所有奖品的总权重
2. 生成 0 到总权重之间的随机数
3. 根据随机数落在的权重区间，确定抽中的奖品

### 算法实现

```typescript
function drawPrize(prizes: Prize[]): Prize {
  // 计算总权重
  const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
  
  // 生成随机数
  const random = Math.random() * totalWeight;
  
  // 找到对应的奖品
  let currentWeight = 0;
  for (const prize of prizes) {
    currentWeight += prize.weight;
    if (random <= currentWeight) {
      return prize;
    }
  }
  
  // 默认返回第一个奖品（理论上不会执行到这里）
  return prizes[0];
}
```

## 奖品配置

### 权重系统

- 总权重：1000
- 每个奖品的概率 = 权重 / 1000

### 奖品示例

| 奖品名称 | 权重 | 概率 | 类型 |
|---------|------|------|------|
| 小红包 | 300 | 30% | 红包 |
| 中红包 | 150 | 15% | 红包 |
| 大红包 | 50 | 5% | 红包 |
| 超级红包 | 10 | 1% | 红包 |
| 经验加成卡（1天） | 200 | 20% | 道具 |
| 积分加成卡（1天） | 200 | 20% | 道具 |
| 段位加成卡（1次） | 50 | 5% | 道具 |
| 限定头像框 | 20 | 2% | 限定奖励 |
| 限定称号 | 15 | 1.5% | 限定奖励 |
| 限定皮肤 | 5 | 0.5% | 限定奖励 |

## 算法特点

1. **公平性**：使用真随机数生成器
2. **透明性**：权重和概率公开
3. **可验证性**：算法逻辑清晰，可验证

## 设计考虑

1. **概率平衡**：常见奖品概率高，稀有奖品概率低
2. **用户体验**：确保用户经常能抽到奖品
3. **游戏平衡**：稀有奖品概率低，保持价值

## 参考资料

- [抽奖模块源码](../../backend/src/lottery/)
- [抽奖模块文档](../features/development-progress.md#7-抽奖模块lottery)

---

**最后更新时间**：2026-01-01 14:46:07

